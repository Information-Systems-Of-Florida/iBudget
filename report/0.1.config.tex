%########################### Preferences #################################
\usepackage{amsmath, amsfonts, amssymb}
%\usepackage[margin=1.2in,headsep=.5in]{geometry}
%\setpapersize{letterpaper}
\usepackage[margin=1in]{geometry}
\usepackage{vmargin} %reduce to amount of white space on the page
\usepackage{longtable}
\usepackage{morefloats}
\usepackage{enumitem}
\usepackage{xcolor}
%\usepackage{tcolorbox}
\usepackage{totpages}
\usepackage{pdflscape}
\usepackage{minted}
\usepackage{listings}
% Code listing settings
\lstset{
    language=Python,
    basicstyle=\ttfamily\small,
    keywordstyle=\color{blue},
    commentstyle=\color{green},
    stringstyle=\color{red},
    showstringspaces=false,
    breaklines=true,
    frame=single,
    numbers=left,
    numberstyle=\tiny\color{gray}
}
\usepackage{listingsutf8}

% ********* Font definiton ************
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{pmboxdraw}  % For box drawing characters
%\usepackage{fontspec}
%\setmainfont{Latin Modern Roman} % Or any other font with good Unicode support
\usepackage{fontawesome5}
\usepackage{pifont} 

% ********* Macro for Models ************
\input{model_template_setup.tex}

%\usepackage[fontsize=10pt]{scrextend} 
%\setmargins{2.5cm}{2.5cm}{15cm}{23cm}{14pt}{3cm}{0pt}{2cm}
% \setmargins{3.5cm}%			% left edge
% 		   {2.5cm}%     % top edge
%            {14.7cm}%		% text width
%            {21.42cm}%   % text hight
%            {14pt}%			% header hight
%            {3cm}%   	  % header distance
%            {0pt}%				% footer hight
%            {2cm}%    	  % footer distance         

%\usepackage{t1enc} % as usual
%\usepackage[latin1]{inputenc} % as usual
%\usepackage{times}		
%\usepackage{mathptmx}  	%mathematical fonts for use with times, I encountered some problems using this package togather with pdftex, which I was not able to resolve

% ********* Graphics definition *******
%\usepackage[pdftex]{graphicx} % required to import graphic files
\usepackage{color} %allows to mark some entries in the tables with color
\usepackage[pdftex]{graphicx}
\usepackage{tcolorbox}
\usepackage{eso-pic} % these two are required to add the little picture on top of every page
\usepackage{everyshi} % these two are required to add the little picture on top of every page
\renewcommand{\floatpagefraction}{0.7} %default:0.5 allows two big pictures on one page

%********** Enabling landscape orientation *******
\usepackage{rotating}

\usepackage{draftwatermark}
\SetWatermarkText{\phantom{} \\DRAFT}
\SetWatermarkScale{4} % Adjust size
\SetWatermarkColor[gray]{0.9} % Set color and transparency

%********** Enybeling Hyperlinks *******
\usepackage[pdfborder=000,pdftex=true]{hyperref}% this enables jumping from a reference and table of content in the pdf file to its target

% ********* Table layout **************
\usepackage{booktabs}	  	%design of table, has an excellent documentation
%\usepackage{lscape}			%use this if you want to rotate the table together with the lines around the table

% ********* Caption Layout ************
\usepackage{ccaption} % allows special formating of the captions
\captionnamefont{\footnotesize\sffamily} % defines the font of the caption name (e.g. Figure: or Table:)
\captiontitlefont{\footnotesize\sffamily} % defines the font of the caption text (same as above, but not bold)
\setlength{\abovecaptionskip}{0mm} %lowers the distace of captions to the figure

\usepackage{sidecap}
\usepackage{tikz}
\usetikzlibrary{decorations.pathreplacing}

% ********* Header and Footer **********
% This is something to play with forever. I use here the advanced settings of the KOMA script
%\usepackage{scrlayer-scrpage} %scrpage2} %header and footer using the options for the KOMA script
%\renewcommand{\headfont}{\footnotesize\sffamily} % font for the header
%\renewcommand{\pnumfont}{\footnotesize\sffamily} % font for the pagenumbers

%the following lines define the pagestyle for the main document
% \defpagestyle{cb}{%
% (\textwidth,0pt)% sets the border line above the header
% {\pagemark\hfill\headmark\hfill}% doublesided, left page
% {\hfill\headmark\hfill\pagemark}% doublesided, right page
% {\hfill\headmark\hfill\pagemark}%  onesided
% (\textwidth,1pt)}% sets the border line below the header
% %
% {(\textwidth,1pt)% sets the border line above the footer
% {\scshape Preliminary report \hfill Correlates of Student Success 2020}% doublesided, left page
% {\scshape Correlates of Student Success 2020 \hfill Preliminary report}% doublesided, right page
% {\scshape Correlates of Student Success 2020 \hfill Preliminary report} % one sided printing
% (\textwidth,0pt)% sets the border line below the footer
% }

% %this defines the page style for the first pages: all empty
% \renewpagestyle{plain}%
% 	{(\textwidth,0pt)%
% 		{\hfill}{\hfill}{\hfill}%
% 	(\textwidth,0pt)}%
% 	{(\textwidth,0pt)%	
% 		{\hfill}{\hfill}{\hfill}%
% 	(\textwidth,0pt)}

%********** Footnotes **********
\renewcommand{\footnoterule}{\rule{5cm}{0.2mm} \vspace{0.3cm}} %increases the distance of footnotes from the text
%\deffootnote[1em]{1em}{1em}{\textsuperscript{\normalfont\thefootnotemark}} %some more formattion on footnotes

%Make section number before figure number.
\renewcommand{\thefigure}{\thesection-\arabic{figure}}

% Display subsections in the TOC
\setcounter{tocdepth}{3}
\setcounter{secnumdepth}{3}

%################ End Preferences #####################

%********** Begin Frontmatter **********

\pagestyle{plain} % on headers or footers on the first page

%########################### MACROS #################################


\usepackage{fancyhdr} % this is for headers and footers
\usepackage[pages=some]{background}
%\backgroundsetup{
%scale=1.0,color=black,opacity=1,angle=0,
%contents={
%  \includegraphics[width=1.25\paperwidth,height=1.3\paperheight]{../figures/cover/BackgroundCover}
%  }
%}
\backgroundsetup{
scale=1.0,color=black,opacity=1,angle=0,
contents={
  \includegraphics[width=0.5\paperwidth,height=0.5\paperheight]{../figures/cover/BackgroundCover}
  }
}
%%************************************************
\pagestyle{fancyplain}
\fancyhf{}
\lhead{\includegraphics[width=1cm]{../assets/ISF-logo-tight.png}} % 
\rhead{\footnotesize{\sc{iBudget- ISF}}} 
\setcounter{page}{1} 
\lfoot{Version $\alpha 0.1$. Obsolescence date: 10/14/2025}%\today -
%\cfoot{\sc{\footnotesize }}
\rfoot{Page \thepage \hspace{0.005cm} of \pageref*{TotPages}} % \ThePageCount
%%************************************************

%\hypersetup{colorlinks=true, linkcolor=blue, filecolor=blue, pagecolor=blue, urlcolor=blue}
%Text styles
\definecolor{Input}{rgb}{0.0,0.45,0.0} % a dark green
\definecolor{Output}{rgb}{0.0,0.0,1.0} % blue
\definecolor{SrcBckgrnd}{rgb}{0.95,0.95,0.95} % blue
\definecolor{HW}{rgb}{0.8,0.0,0.0} % red
\definecolor{UTSABlue}{rgb}{0.047,0.137,0.251} 
\definecolor{UTSAOrange}{rgb}{0.945,0.353,0.133} 
\newcommand\textstyleInput[1]{\texttt{\textbf{\textcolor[rgb]{0.0,0.45,0.0}{#1}}}}
\newcommand\textstyleOutput[1]{\texttt{{\textcolor[rgb]{0.0,0.75,0.0}{#1}}}} 

\newcommand{\low}{\textnormal{\tiny\textit{low}}\hspace{-5pt}}
\newcommand{\high}{\textnormal{\tiny \textit{high}}\hspace{-5pt}}
\newcommand{\vv}{{\bf v}}
\newcommand{\mb}{\left[\begin{matrix}}
\newcommand{\me}{\end{matrix}\right]}
\newcommand{\lam}{\lambda}
\newcommand{\PP}{\hbox{I\kern-0.2em\hbox{P}}}
\newcommand{\RR}{\hbox{I\kern-0.2em\hbox{R}}}
\newcommand{\ZZ}{\hbox{Z\kern-0.35em\hbox{Z}}}
\newcommand{\R}{{\mathbb{R}}}
\newcommand{\N}{{\mathbb{N}}}
\newcommand{\Z}{{\mathbb{Z}}}
\newcommand{\Q}{{\mathbb{Q}}}
\newcommand{\C}{{\mathbb{C}}}
\newcommand{\M}{{\mathbb{M}}}
\newcommand{\e}{\mathrm{e}}
\newcommand{\ee}{\mathrm{e}}
\newcommand{\mat}[1]{\bmatrix #1\endbmatrix}
\newcommand{\sinc}{\operatorname{sinc}}
\newcommand{\rect}{\operatorname{rect}}
\newcommand{\conj}{\overline}
\newcommand{\ebb}{\mathrm{\textbf{e}}}
\newcommand{\mbb}{\textbf{m}}
\newcommand{\y}{\textbf{y}}
\newcommand{\x}{\textbf{x}}
\newcommand{\X}{\textbf{X}}
\newcommand{\z}{\textbf{z}}
\newcommand{\A}{\textbf{A}}
\newcommand{\Sbb}{\textbf{S}}
\newcommand\bb{\textbf{b}}
\newcommand\vs{\vspace{0.2in}}
%\newcommand{\vs}{\vspace*{0.1in}\noindent}

% Define commands for the symbols with tikz
% \newcommand{\greencheck}{%
%     \tikz\fill[scale=0.4,color=green!70!black](0,.35) -- (.25,0) -- (1,.7) -- (.25,.15) -- cycle;%
% }
% \newcommand{\yellowwarning}{%
%     \tikz\draw[scale=0.4,color=yellow!80!orange,fill=yellow!80!orange] (0,0) -- (1,0) -- (0.5,0.866) -- cycle;%
%     \tikz\node[scale=0.3] at (0.2,0.15) {\textbf{!}};%
% }
% \newcommand{\redcross}{%
%     \tikz[scale=0.4]{
%         \draw[color=red,line width=1pt] (0,0) -- (1,1);
%         \draw[color=red,line width=1pt] (0,1) -- (1,0);
%     }%
% }

% Define commands for the symbols with fontawsome
\newcommand{\greencheck}{\textcolor{green!70!black}{\faCheckCircle}\hspace{0.05in}}
\newcommand{\yellowwarning}{\textcolor{yellow!80!orange}{\faExclamationTriangle}\hspace{0.05in}}
\newcommand{\redcross}{\textcolor{red}{\faTimesCircle}\hspace{0.05in}}

\newcounter{example}[section]
\newenvironment{example}[1][]{\refstepcounter{example}\par\medskip
   \noindent \textbf{Example~\theexample. #1} \rmfamily}{\medskip}


\newcommand\BeginCode{\medskip\begin{minipage}{0.9\textwidth} \color{Input} \begin{verbatim}} % \vspace{0.1cm}
\newcommand\EndCode{\vspace{0.01cm}\end{minipage}} % \vspace{0.01cm}

\newcommand\s{\color{Input}\ttfamily} % Code snippet. Use: {\s code here}

\newcounter{QaA}
\newenvironment{EQA}[1][]{\refstepcounter{QaA} \color{HW} Record your explanation as answer \#\theQaA. #1 }{\medskip}
\newcommand\QA{\begin{EQA} \end{EQA}} 


% Outlier analysis commands

\newcommand{\WarningRunPiepeline}{WARNING: Value undefined. Run the analysis pipeline}
\newcommand{\placeholder}{\textcolor{red}{[VALUE NOT SET]}}


% Overall statistics
\newcommand{\TheTotalNumberCustomers}{\WarningRunPiepelinee}
\newcommand{\TheInitialYear}{\WarningRunPiepeline}
\newcommand{\TheFinalYear}{\WarningRunPiepeline}
\newcommand{\TheTotalCustomerYears}{\WarningRunPiepeline}

% Customer data availability
\newcommand{\CustomerNumberOneYear}{\WarningRunPiepeline}
\newcommand{\CustomerPctOneYear}{\WarningRunPiepeline}
\newcommand{\CustomerNumberTwoPlusYear}{\WarningRunPiepeline}
\newcommand{\CustomerPctTwoPlusYear}{\WarningRunPiepeline}
\newcommand{\CustomerNumberNoData}{\WarningRunPiepeline}
\newcommand{\CustomerPctNoData}{\WarningRunPiepeline}

% Exclusion statistics
\newcommand{\ExclusionMidYearQSICount}{\WarningRunPiepeline}
\newcommand{\ExclusionMidYearQSIPct}{\WarningRunPiepeline}
\newcommand{\ExclusionLateEntryCount}{\WarningRunPiepeline}
\newcommand{\ExclusionLateEntryPct}{\WarningRunPiepeline}
\newcommand{\ExclusionEarlyExitCount}{\WarningRunPiepeline}
\newcommand{\ExclusionEarlyExitPct}{\WarningRunPiepeline}
\newcommand{\ExclusionNoCostsCount}{\WarningRunPiepeline}
\newcommand{\ExclusionNoCostsPct}{\WarningRunPiepeline}
\newcommand{\ExclusionInsufficientServiceCount}{\WarningRunPiepeline}
\newcommand{\ExclusionInsufficientServicePct}{\WarningRunPiepeline}
\newcommand{\ExclusionNoQSICount}{\WarningRunPiepeline}
\newcommand{\ExclusionNoQSIPct}{\WarningRunPiepeline}

% Cost statistics
\newcommand{\AvgAnnualCost}{\WarningRunPiepeline}
\newcommand{\MedianAnnualCost}{\WarningRunPiepeline}
\newcommand{\StdevAnnualCost}{\WarningRunPiepeline}

% Trajectory analysis
\newcommand{\CustomersWithTrajectory}{\WarningRunPiepeline}
\newcommand{\PctWithTrajectory}{\WarningRunPiepeline}
\newcommand{\CustomersWithGaps}{\WarningRunPiepeline}
\newcommand{\PctWithGaps}{\WarningRunPiepeline}

% Outlier statistics
\newcommand{\OutlierLowerFence}{\WarningRunPiepeline}
\newcommand{\OutlierUpperFence}{\WarningRunPiepeline}
\newcommand{\OutliersBelow}{\WarningRunPiepeline}
\newcommand{\OutliersAbove}{\WarningRunPiepeline}
\newcommand{\OutlierRate}{\WarningRunPiepeline}

% Proration Analysis Commands 

\newcommand{\ProrationFullYearPct}{\WarningRunPipeline}
\newcommand{\ProrationHighCoveragePct}{\WarningRunPipeline}
\newcommand{\ProrationMedianRFull}{\WarningRunPipeline}
\newcommand{\ProrationMedianRLow}{\WarningRunPipeline}
\newcommand{\ProrationTotalCustomerYears}{\WarningRunPipeline}
\newcommand{\ProrationFullYearCount}{\WarningRunPipeline}
\newcommand{\ProrationHighCoverageCount}{\WarningRunPipeline}

% Command definition for all models
\newcommand{\WarningRunPipeline}{\textcolor{red}{[RUN PIPELINE]}}


% Load variable definitions per model

\IfFileExists{models/model_1/model_1_newcommands.tex}{\input{models/model_1/model_1_newcommands.tex}}{}
\IfFileExists{models/model_2/model_2_newcommands.tex}{\input{models/model_2/model_2_newcommands.tex}}{}
\IfFileExists{models/model_3/model_3_newcommands.tex}{\input{models/model_3/model_3_newcommands.tex}}{}
\IfFileExists{models/model_4/model_4_newcommands.tex}{\input{models/model_4/model_4_newcommands.tex}}{}
\IfFileExists{models/model_5/model_5_newcommands.tex}{\input{models/model_5/model_5_newcommands.tex}}{}
\IfFileExists{models/model_6/model_6_newcommands.tex}{\input{models/model_6/model_6_newcommands.tex}}{}
\IfFileExists{models/model_7/model_7_newcommands.tex}{\input{models/model_7/model_7_newcommands.tex}}{}
\IfFileExists{models/model_8/model_8_newcommands.tex}{\input{models/model_8/model_8_newcommands.tex}}{}
\IfFileExists{models/model_9/model_9_newcommands.tex}{\input{models/model_9/model_9_newcommands.tex}}{}
\IfFileExists{models/model_10/model_10_newcommands.tex}{\input{models/model_10/model_10_newcommands.tex}}{}

